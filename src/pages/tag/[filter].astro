---
import { POST_COUNT_PER_PAGE } from '@/packages/consts';
import { getFilterByTagPage, isValidTagFilter, mapServerPostToClient } from '@/packages/utils/filter';
import BlogListPage from '@/src/components/BlogListPage.astro';
import NotFound from "../404.astro";


export const prerender = true;
export const getStaticPaths = getFilterByTagPage;

const limitedPosts = Astro.props.posts.slice(0, POST_COUNT_PER_PAGE);
const posts = await mapServerPostToClient(limitedPosts);

const { filter } = Astro.params;
const subTitle = filter.replaceAll("/", " | ");
const isValid = await isValidTagFilter(filter);

const totalPostsCount = Astro.props.posts.length;
---

{isValid ? <BlogListPage subTitle={subTitle} posts={posts} totalCount={totalPostsCount} /> : <NotFound />}
