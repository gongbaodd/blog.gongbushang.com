---
import { POST_COUNT_PER_PAGE } from "../../packages/consts";

import {
  getFilterByCategoryPage,
  isValidCategoryFilter,
} from "../../packages/utils/filter";
import BlogListPage from "../components/BlogListPage.astro";

export const prerender = true;

export const getStaticPaths = getFilterByCategoryPage;
const limitedPosts = Astro.props.posts.slice(0, POST_COUNT_PER_PAGE);
const totalPostsCount = Astro.props.posts.length;

const { filter } = Astro.params;
const subTitle = filter.replaceAll("/", " | ");
const isValid = await isValidCategoryFilter(filter);

if (!isValid) {
  Astro.redirect("/404");
}
---

<BlogListPage
  subTitle={subTitle}
  posts={limitedPosts}
  totalCount={totalPostsCount}
  filter={filter}
/>
