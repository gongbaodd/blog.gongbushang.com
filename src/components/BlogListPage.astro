---
import Global from "../../packages/layouts/Global.astro";
import BaseHead from "../../packages/components/BaseHead.astro";
import {
  SITE_DESCRIPTION,
  SITE_TITLE,
  FILTER_ENTRY,
} from "../../packages/consts";
import MantineMain from "./MantineMain";
import BlogList, {
  BlogGrid,
  BlogGridSSR,
  BlogListNanoStore,
  MenuCategory,
  MenuSeries,
  MenuTag,
} from "./BlogList";
import Footer from "@/packages/components/Footer.astro";
import {
  getCategoriesFrom,
  getSeriesFrom,
  getTagsFrom,
} from "@/packages/utils/badges";
import type { CollectionEntry } from "astro:content";
import { mapServerPostToClient } from "@/packages/utils/filter";
import Header from "@/packages/components/Header.astro";

type T_POST = CollectionEntry<"blog">;
interface Props {
  subTitle: string;
  posts: T_POST[];
  totalCount: number;
  filter: string;
  entryType?: FILTER_ENTRY;
}

const {
  subTitle,
  posts: limitedPosts,
  filter,
  entryType,
  totalCount,
} = Astro.props;
const posts = await mapServerPostToClient(limitedPosts);
const [categories, series, tags] = await Promise.all([
  getCategoriesFrom(limitedPosts),
  getSeriesFrom(limitedPosts),
  getTagsFrom(limitedPosts),
]);
---

<Global>
  <BaseHead
    title={`${SITE_TITLE} | ${subTitle}`}
    description={SITE_DESCRIPTION}
    slot="head"
  />
  <BlogListNanoStore
    posts={posts}
    filter={filter}
    entryType={entryType}
    totalCount={totalCount}
    client:load
  />
  <Header/>
  <MantineMain>
    <BlogList posts={posts}>
      <MenuCategory slot="menuCategory" categories={categories} />
      <MenuSeries slot="menuSeries" series={series} />
      <MenuTag slot="menuTag" tags={tags} />
      <BlogGridSSR slot="blogGridxs" posts={posts} size="xs" />
      <BlogGridSSR slot="blogGridsm" posts={posts} size="sm" />
      <BlogGridSSR slot="blogGridmd" posts={posts} size="md" />
      <BlogGridSSR slot="blogGridlg" posts={posts} size="lg" />
      <BlogGridSSR slot="blogGridxl" posts={posts} size="xl" />
      <BlogGrid slot="blogGrid" client:only />
    </BlogList>
    <Footer />
  </MantineMain>
</Global>
