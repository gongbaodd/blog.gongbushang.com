---
import MantineHeader from "@/packages/header/MantineHeader";
import Search from "@/packages/search/Search";
import HeaderNanoStore from "./store/HeaderNanoStore";
import { $pathname } from "./store/pathname";
import { ROUTE_LABEL } from "../consts";
import HomeSkeleton from "@/src/skeletons/home";
import BlogSkeleton from "@/src/skeletons/blog";
import WorldSkeleton from "@/src/skeletons/world";
import ArchiveSkeleton from "@/src/skeletons/archive";

const pathName = normalizePath(Astro.url.pathname);
$pathname.set(pathName);

function normalizePath(path: string) {
  return path.endsWith("/") && path !== "/" ? path.slice(0, -1) : path;
}
---

<header transition:persist>
  <HeaderNanoStore pathname={pathName} client:load />
  <MantineHeader client:load>
    <Search slot={"searchNode"} client:idle />
    <section transition:name={ROUTE_LABEL.Home} slot={"loaderHome"}>
      <HomeSkeleton client:only/>
    </section>
    <section transition:name={ROUTE_LABEL.Blog} slot={"loaderBlog"}>
      <BlogSkeleton client:only />
    </section>
    <section transition:name={ROUTE_LABEL.World} slot={"loaderWorld"}>
      <WorldSkeleton client:only />
    </section>
    <section transition:name={ROUTE_LABEL.Archive} slot={"loaderArchive"}>
      <ArchiveSkeleton client:only/>
    </section>
  </MantineHeader>
</header>
